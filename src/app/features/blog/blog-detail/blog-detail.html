<div class="relative overflow-hidden bg-[#F7FAFF]">
  <!-- soft blobs background -->
  <div class="pointer-events-none absolute inset-0">
    <div
      class="absolute -top-28 -left-28 h-[560px] w-[560px] rounded-full bg-[#AFCEE3]/55 blur-3xl"
    ></div>
    <div
      class="absolute -bottom-28 -right-28 h-[560px] w-[560px] rounded-full bg-[#C3B692]/35 blur-3xl"
    ></div>
    <div
      class="absolute top-1/3 right-1/4 h-[420px] w-[420px] rounded-full bg-[#215EBB]/10 blur-3xl"
    ></div>
  </div>

  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12 md:py-16 relative">
    <div class="max-w-4xl mx-auto">
      <!-- Breadcrumb -->
      <nav class="text-sm text-[#0E2859]/60 mb-6">
        <a routerLink="/" class="hover:text-[#215EBB] transition">Inicio</a>
        <span class="mx-2 text-[#0E2859]/30">/</span>
        <a routerLink="/blog" class="hover:text-[#215EBB] transition">Blog</a>
        <span class="mx-2 text-[#0E2859]/30">/</span>

        @if (post()) {
        <span class="text-[#0E2859] font-semibold">{{ post()!.title }}</span>
        } @else {
        <span class="text-[#0E2859] font-semibold">Artículo</span>
        }
      </nav>

      <!-- Back row -->
      <div class="flex items-center justify-between gap-3 mb-6">
        <a
          routerLink="/blog"
          class="inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-extrabold bg-white/80 backdrop-blur border border-[#0E2859]/10 text-[#0E2859] hover:bg-[#AFCEE3]/25 hover:border-[#215EBB]/25 transition"
        >
          <lucide-icon [img]="iBack" class="w-4 h-4"></lucide-icon>
          Volver al blog
        </a>

        <button
          type="button"
          (click)="copyLink()"
          class="inline-flex items-center gap-2 rounded-full px-4 py-2 text-sm font-extrabold bg-white/80 backdrop-blur border border-[#0E2859]/10 text-[#0E2859] hover:bg-[#AFCEE3]/25 hover:border-[#215EBB]/25 transition"
        >
          <lucide-icon [img]="iLink" class="w-4 h-4"></lucide-icon>
          Copiar link
        </button>
      </div>

      <!-- Loading -->
      @if (loading()) {
      <div class="rounded-2xl border border-[#0E2859]/10 bg-white/80 backdrop-blur p-7 shadow-sm">
        <div class="animate-pulse">
          <div class="h-6 w-28 rounded-full bg-[#0E2859]/10 mb-5"></div>
          <div class="h-10 rounded-lg bg-[#0E2859]/10 mb-4 w-5/6"></div>
          <div class="h-5 rounded-lg bg-[#0E2859]/10 mb-2 w-full"></div>
          <div class="h-5 rounded-lg bg-[#0E2859]/10 mb-6 w-4/5"></div>
          <div class="h-64 rounded-2xl bg-[#0E2859]/10"></div>
        </div>
      </div>

      <!-- Error -->
      } @else if (error()) {
      <div class="text-center rounded-2xl border border-red-200 bg-red-50 p-6 text-red-700">
        {{ error() }}
      </div>

      <!-- Content -->
      } @else {

      <article
        class="rounded-2xl border border-[#0E2859]/10 bg-white/85 backdrop-blur shadow-sm overflow-hidden"
      >
        <div class="p-7 md:p-10">
          <!-- Tag -->
          <div
            class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-extrabold bg-[#AFCEE3]/35 text-[#0E2859] border border-[#0E2859]/10 mb-4"
          >
            <lucide-icon [img]="iTag" class="w-3.5 h-3.5"></lucide-icon>
            {{ post()!.tag }}
          </div>

          <!-- Title -->
          <h1
            class="text-3xl md:text-4xl font-extrabold text-[#0E2859] leading-[1.08] text-balance"
          >
            {{ post()!.title }}
          </h1>

          <!-- Excerpt -->
          @if (post()!.excerpt) {
          <p class="mt-4 text-lg text-[#0E2859]/70 leading-relaxed text-pretty">
            {{ post()!.excerpt }}
          </p>
          }

          <!-- Meta -->
          <div class="mt-6 flex flex-wrap items-center gap-x-6 gap-y-2 text-sm text-[#0E2859]/60">
            <span class="inline-flex items-center gap-2">
              <lucide-icon [img]="iCalendar" class="w-4 h-4"></lucide-icon>
              {{ formatDate(post()!.published_at) }}
            </span>

            <span class="inline-flex items-center gap-2">
              <lucide-icon [img]="iClock" class="w-4 h-4"></lucide-icon>
              {{ post()!.read_time }}
            </span>
          </div>
        </div>

        <!-- Cover (optional) -->
        <!-- @if (post()!.cover_image_url) {
        <div class="px-7 md:px-10 pb-2">
          <img
            [src]="post()!.cover_image_url"
            [alt]="post()!.title"
            class="w-full h-[240px] md:h-[340px] object-cover rounded-2xl border border-[#0E2859]/10"
            loading="lazy"
          />
        </div>
        } -->

        <!-- Body -->
        <div class="px-7 md:px-10 pb-10">
          <div class="article-prose" [innerHTML]="safeHtml()"></div>
        </div>
      </article>

      <!-- Related -->
      @if (related().length > 0) {
      <section class="mt-10 md:mt-12">
        <h2 class="text-xl font-extrabold text-[#0E2859] mb-5">
          Más artículos de <span class="text-[#CE6C37]">{{ post()!.tag }}</span>
        </h2>

        <div class="grid md:grid-cols-3 gap-6">
          @for (r of related(); track r.slug) {
          <a
            [routerLink]="['/blog', r.slug]"
            class="group block rounded-2xl border border-[#0E2859]/10 bg-white/85 backdrop-blur p-6 shadow-sm hover:shadow-xl hover:-translate-y-1 transition overflow-hidden"
          >
            <div
              class="inline-flex items-center gap-2 rounded-full px-3 py-1 text-xs font-extrabold bg-[#AFCEE3]/35 text-[#0E2859] border border-[#0E2859]/10 mb-4"
            >
              <lucide-icon [img]="iTag" class="w-3.5 h-3.5"></lucide-icon>
              {{ r.tag }}
            </div>

            <div class="text-lg font-extrabold text-[#0E2859] leading-snug mb-2 text-balance">
              {{ r.title }}
            </div>

            <div class="text-sm text-[#0E2859]/70 leading-relaxed text-pretty mb-4">
              {{ r.excerpt }}
            </div>

            <div class="flex items-center justify-between text-xs text-[#0E2859]/55">
              <span class="inline-flex items-center gap-1">
                <lucide-icon [img]="iCalendar" class="w-3.5 h-3.5"></lucide-icon>
                {{ formatDate(r.published_at) }}
              </span>

              <span class="inline-flex items-center gap-1">
                <lucide-icon [img]="iClock" class="w-3.5 h-3.5"></lucide-icon>
                {{ r.read_time }}
              </span>
            </div>
          </a>
          }
        </div>
      </section>
      } }
    </div>
  </div>
</div>
