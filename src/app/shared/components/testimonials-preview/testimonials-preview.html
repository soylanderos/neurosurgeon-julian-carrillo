<!-- Testimonials Preview (Cards, comment ALWAYS visible, filled stars) -->
<section class="relative py-20 md:py-28 bg-[#F7FAFF] overflow-hidden">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 relative">
    <!-- Header -->
    <div class="text-center mb-12 md:mb-16">
      <span
        class="inline-flex items-center gap-2 rounded-full px-4 py-2 text-xs font-extrabold tracking-wide bg-white/70 text-[#0E2859] ring-1 ring-[#0E2859]/10 shadow-sm"
      >
        <span class="h-2 w-2 rounded-full bg-[#CE6C37]"></span>
        Testimonios
      </span>

      <h2 class="mt-4 text-3xl md:text-4xl lg:text-5xl font-extrabold text-[#0E2859] text-balance">
        Lo que dicen nuestros pacientes
      </h2>

      <p class="mt-3 text-lg text-[#0E2859]/70 max-w-2xl mx-auto text-pretty">
        Opiniones reales tomadas de Doctoralia. Transparencia total.
      </p>
    </div>

    <!-- States -->
    @if (error()) {
    <div
      class="max-w-3xl mx-auto rounded-2xl border border-red-200 bg-white/80 p-6 text-center text-red-700"
    >
      {{ error() }}
    </div>
    } @else { @if (loading()) {
    <!-- Skeletons -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (i of skeletonItems; track i) {
      <div
        class="rounded-3xl border border-[#0E2859]/10 bg-white/80 p-6 shadow-sm"
        aria-hidden="true"
      >
        <div class="animate-pulse">
          <div class="flex items-start justify-between gap-4">
            <div class="flex items-center gap-3">
              <div class="h-12 w-12 rounded-2xl bg-slate-200"></div>
              <div class="space-y-2">
                <div class="h-5 w-40 bg-slate-200 rounded-lg"></div>
                <div class="h-4 w-28 bg-slate-200 rounded-lg"></div>
              </div>
            </div>
            <div class="h-7 w-24 bg-slate-200 rounded-full"></div>
          </div>

          <div class="mt-4 h-5 w-40 bg-slate-200 rounded-lg"></div>
          <div class="mt-5 space-y-2">
            <div class="h-4 w-full bg-slate-200 rounded-lg"></div>
            <div class="h-4 w-11/12 bg-slate-200 rounded-lg"></div>
            <div class="h-4 w-10/12 bg-slate-200 rounded-lg"></div>
          </div>

          <div class="mt-6 h-4 w-2/3 bg-slate-200 rounded-lg"></div>
        </div>
      </div>
      }
    </div>
    } @else { @if (testimonials().length === 0) {
    <div
      class="max-w-3xl mx-auto rounded-2xl border border-[#0E2859]/10 bg-white/80 p-6 text-center text-[#0E2859]/70"
    >
      Aún no hay testimonios disponibles.
    </div>
    } @else {
    <!-- Grid -->
    <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6">
      @for (t of testimonials(); track t.id) {
      <article
        class="group relative rounded-3xl border border-[#0E2859]/10 bg-white/80 backdrop-blur shadow-sm hover:shadow-xl transition-all hover:-translate-y-1 overflow-hidden"
      >
        <!-- subtle watermark / pattern -->
        <div
          class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition"
        >
          <div
            class="absolute -top-12 -right-12 h-44 w-44 rounded-full bg-[#AFCEE3]/45 blur-3xl"
          ></div>
          <div
            class="absolute -bottom-14 -left-14 h-52 w-52 rounded-full bg-[#CE6C37]/15 blur-3xl"
          ></div>
        </div>

        <!-- Top accent line -->
        <div class="h-1.5 w-full bg-gradient-to-r from-[#CE6C37] via-[#215EBB] to-[#AFCEE3]"></div>

        <div class="relative p-6">
          <!-- Header row -->
          <div class="flex items-start justify-between gap-4">
            <div class="flex items-start gap-3 min-w-0">
              <!-- quote badge -->
              <div
                class="h-12 w-12 rounded-2xl bg-[#AFCEE3]/35 ring-1 ring-[#0E2859]/10 flex items-center justify-center flex-shrink-0"
                aria-hidden="true"
              >
                <svg class="h-6 w-6 text-[#215EBB]" viewBox="0 0 24 24" fill="none">
                  <path
                    d="M7 11c-1.66 0-3 1.34-3 3v3h6v-3c0-1.66-1.34-3-3-3Z"
                    fill="currentColor"
                    opacity="0.25"
                  />
                  <path
                    d="M17 11c-1.66 0-3 1.34-3 3v3h6v-3c0-1.66-1.34-3-3-3Z"
                    fill="currentColor"
                    opacity="0.25"
                  />
                  <path
                    d="M8.5 11.1c.3-2.4 1.8-4.2 4.5-5.1"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                  <path
                    d="M18.5 11.1c.3-2.4 1.8-4.2 4.5-5.1"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                  />
                </svg>
              </div>

              <div class="min-w-0">
                <p class="truncate text-lg font-extrabold text-[#0E2859]">
                  {{ t.author }}
                </p>

                <div
                  class="mt-0.5 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-[#0E2859]/55"
                >
                  @if (t.dateText) { <span>{{ t.dateText }}</span> } @if (t.service) {
                  <span class="h-1 w-1 rounded-full bg-[#0E2859]/25"></span>
                  <span class="truncate max-w-[180px]">{{ t.service }}</span>
                  }
                </div>
              </div>
            </div>

            @if (t.isVerified) {
            <span
              class="inline-flex items-center gap-1 rounded-full bg-[#CE6C37]/10 px-2.5 py-1 text-xs font-extrabold text-[#CE6C37] border border-[#CE6C37]/15 flex-shrink-0"
            >
              <span class="h-1.5 w-1.5 rounded-full bg-[#CE6C37]"></span>
              Verificada
            </span>
            }
          </div>

          <!-- Stars (filled) -->
          <div class="mt-4 flex items-center gap-2">
            <div class="flex items-center gap-1" aria-label="Calificación">
              @for (filled of stars(t.rating); track $index) {
              <svg class="h-5 w-5" viewBox="0 0 24 24" aria-hidden="true">
                <!-- base -->
                <path
                  d="M12 17.3 6.8 20l1-5.8L3 9.8l5.9-.8L12 3.8l3.1 5.2 5.9.8-4.8 4.4 1 5.8L12 17.3Z"
                  class="fill-[#CE6C37]/15"
                />
                <!-- filled or outline -->
                @if (filled) {
                <path
                  d="M12 17.3 6.8 20l1-5.8L3 9.8l5.9-.8L12 3.8l3.1 5.2 5.9.8-4.8 4.4 1 5.8L12 17.3Z"
                  class="fill-[#CE6C37]"
                />
                } @else {
                <path
                  d="M12 17.3 6.8 20l1-5.8L3 9.8l5.9-.8L12 3.8l3.1 5.2 5.9.8-4.8 4.4 1 5.8L12 17.3Z"
                  class="fill-transparent stroke-[#CE6C37]/35"
                  stroke-width="1.6"
                />
                }
              </svg>
              }
            </div>

            <span class="text-xs font-extrabold text-[#0E2859]/60"> {{ t.rating }}/5 </span>
          </div>

          <!-- Comment (ALWAYS visible, no accordion) -->
          <p class="mt-4 text-[#0E2859]/80 leading-relaxed text-sm md:text-[15px] text-pretty">
            {{ t.comment }}
          </p>

          <!-- Meta line -->
          <div class="mt-4 flex flex-wrap items-center gap-x-3 gap-y-1 text-xs text-[#0E2859]/55">
            @if (t.clinic) {
            <span>{{ t.clinic }}</span>
            } @if (t.sourceUrl) {
            <span class="h-1 w-1 rounded-full bg-[#0E2859]/25"></span>
            <a
              [href]="t.sourceUrl"
              target="_blank"
              rel="noopener"
              class="font-extrabold text-[#215EBB] hover:underline"
            >
              Ver en Doctoralia
            </a>
            }
          </div>
        </div>
      </article>
      }
    </div>

    <!-- Bottom CTA -->
    <div class="text-center mt-12">
      <a
        [routerLink]="['/testimonios']"
        class="inline-flex items-center justify-center gap-2 rounded-full px-7 py-3 text-sm font-extrabold bg-[#0E2859] text-white shadow-sm hover:shadow-md hover:-translate-y-0.5 transition"
      >
        Ver más testimonios
        <span class="inline-flex h-8 w-8 items-center justify-center rounded-full bg-white/10">
          <svg class="h-4 w-4" viewBox="0 0 24 24" fill="none" aria-hidden="true">
            <path
              d="M9 18l6-6-6-6"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </span>
      </a>
    </div>
    } } }
  </div>
</section>
